<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InMobirelia - Inicio</title>
    <!-- Carga de Tailwind CSS vía CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuración de fuente Inter (opcional, pero mejora la estética) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            /* Blanco suave */
        }

        /* Estilo para el hover de las tarjetas (efecto minimalista) */
        .card-hover:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
    </style>
    <script>
        // Configuración de URLs de la API
        const API_CONFIG = {
            BASE_URL: 'http://127.0.0.1:8000',
            REGISTER_URL: 'http://127.0.0.1:8000/auth/register/',
            LOGIN_URL: 'http://127.0.0.1:8000/auth/login/'
        };

        // Gestión de modales y autenticación
        document.addEventListener('DOMContentLoaded', () => {
            const loginModal = document.getElementById('login-modal');
            const registerModal = document.getElementById('register-modal');
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const exploreBtn = document.getElementById('explore-btn');

            // ==================== FUNCIONES AUXILIARES ====================

            // Función para mostrar notificaciones
            function showNotification(message, type = 'info') {
                // Crear elemento de notificación si no existe
                let notification = document.getElementById('notification');
                if (!notification) {
                    notification = document.createElement('div');
                    notification.id = 'notification';
                    notification.className = 'fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-4 rounded-xl shadow-2xl text-sm font-medium transition-all duration-300 z-[60] min-w-[300px] text-center';
                    document.body.appendChild(notification);
                }

                // Establecer estilos según el tipo
                const styles = {
                    success: 'bg-green-100 border-2 border-green-500 text-green-800',
                    error: 'bg-red-100 border-2 border-red-500 text-red-800',
                    info: 'bg-indigo-100 border-2 border-indigo-500 text-indigo-800'
                };

                notification.className = notification.className.split(' ').slice(0, 12).join(' ') + ' ' + styles[type];
                notification.textContent = message;
                notification.classList.remove('hidden');

                // Ocultar después de 4 segundos
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 4000);
            }

            // Función para guardar token en localStorage
            function saveToken(token) {
                try {
                    localStorage.setItem('auth_token', token);
                    console.log('Token guardado exitosamente');
                    return true;
                } catch (error) {
                    console.error('Error al guardar el token:', error);
                    showNotification('Error al guardar sesión', 'error');
                    return false;
                }
            }

            // Función para obtener token de localStorage
            function getToken() {
                return localStorage.getItem('auth_token');
            }

            // Función para eliminar token (logout)
            function clearToken() {
                localStorage.removeItem('auth_token');
            }

            // Función para abrir modal
            function openModal(modal) {
                closeAllModals();
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            // Función para cerrar todos los modales
            function closeAllModals() {
                loginModal.classList.add('hidden');
                registerModal.classList.add('hidden');
                document.body.style.overflow = '';
            }

            // ==================== MANEJO DE REGISTRO ====================

            async function handleRegister(e) {
                e.preventDefault();

                // Obtener valores del formulario
                const email = document.getElementById('register-email').value.trim();
                const nombres = document.getElementById('register-nombres').value.trim();
                const apellidos = document.getElementById('register-apellidos').value.trim();
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;

                // Validar que las contraseñas coincidan
                if (password !== confirmPassword) {
                    showNotification('Las contraseñas no coinciden', 'error');
                    return;
                }

                // Validar longitud mínima de contraseña
                if (password.length < 6) {
                    showNotification('La contraseña debe tener al menos 6 caracteres', 'error');
                    return;
                }

                // Preparar datos para enviar
                const data = {
                    email: email,
                    nombres: nombres,
                    apellidos: apellidos,
                    password: password
                };

                try {
                    // Mostrar indicador de carga
                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Creando cuenta...';
                    submitBtn.disabled = true;

                    // Realizar petición POST
                    const response = await fetch(API_CONFIG.REGISTER_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    // Restaurar botón
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;

                    if (response.ok || response.status === 201) {
                        // Registro exitoso
                        if (result.token) {
                            saveToken(result.token);
                        }
                        showNotification('¡Cuenta creada exitosamente! Redirigiendo...', 'success');

                        // Limpiar formulario
                        e.target.reset();

                        // Redirigir a menu.html después de 1.5 segundos
                        setTimeout(() => {
                            closeAllModals();
                            window.location.href = 'menu.html';
                        }, 1500);
                    } else {
                        // Manejar errores del servidor
                        let errorMessage = 'Error al crear la cuenta';

                        if (result.email && Array.isArray(result.email)) {
                            errorMessage = result.email[0];
                        } else if (result.error) {
                            errorMessage = result.error;
                        } else if (result.message) {
                            errorMessage = result.message;
                        }

                        showNotification(errorMessage, 'error');
                    }
                } catch (error) {
                    console.error('Error en el registro:', error);
                    showNotification('Error de conexión. Verifica que el servidor esté activo', 'error');

                    // Restaurar botón en caso de error
                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    submitBtn.textContent = 'Crear Cuenta';
                    submitBtn.disabled = false;
                }
            }

            // ==================== MANEJO DE LOGIN ====================

            async function handleLogin(e) {
                e.preventDefault();

                // Obtener valores del formulario
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;

                // Preparar datos para enviar
                const data = {
                    email: email,
                    password: password
                };

                try {
                    // Mostrar indicador de carga
                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Iniciando sesión...';
                    submitBtn.disabled = true;

                    // Realizar petición POST
                    const response = await fetch(API_CONFIG.LOGIN_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    // Restaurar botón
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;

                    if (response.ok) {
                        // Login exitoso
                        if (result.token) {
                            saveToken(result.token);
                            showNotification('¡Sesión iniciada correctamente! Redirigiendo...', 'success');

                            // Limpiar formulario
                            e.target.reset();

                            // Redirigir a menu.html después de 1.5 segundos
                            setTimeout(() => {
                                closeAllModals();
                                window.location.href = 'menu.html';
                            }, 1500);
                        } else {
                            showNotification('Error: Token no recibido', 'error');
                        }
                    } else {
                        // Manejar errores de autenticación
                        let errorMessage = 'Email o contraseña incorrectos';

                        if (result.error) {
                            errorMessage = result.error;
                        } else if (result.message) {
                            errorMessage = result.message;
                        } else if (result.non_field_errors) {
                            errorMessage = result.non_field_errors[0];
                        }

                        showNotification(errorMessage, 'error');
                    }
                } catch (error) {
                    console.error('Error en el login:', error);
                    showNotification('Error de conexión. Verifica que el servidor esté activo', 'error');

                    // Restaurar botón en caso de error
                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    submitBtn.textContent = 'Acceder';
                    submitBtn.disabled = false;
                }
            }

            // ==================== EVENT LISTENERS ====================

            // Abrir modales
            loginBtn.addEventListener('click', () => openModal(loginModal));
            registerBtn.addEventListener('click', () => openModal(registerModal));

            // Botón explorar
            exploreBtn.addEventListener('click', () => {
                console.log('Explorar Propiedades clickeado');
                showNotification('Funcionalidad en desarrollo', 'info');
            });

            // Cerrar modales con el botón X
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });

            // Cerrar modales al hacer clic en el overlay
            [loginModal, registerModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeAllModals();
                    }
                });
            });

            // Cerrar modales con la tecla Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });

            // Cambiar entre modales
            document.getElementById('go-to-login').addEventListener('click', (e) => {
                e.preventDefault();
                openModal(loginModal);
            });

            document.getElementById('go-to-register').addEventListener('click', (e) => {
                e.preventDefault();
                openModal(registerModal);
            });

            // Manejar envío de formularios
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);

            // Verificar si hay token al cargar la página
            const token = getToken();
            if (token) {
                console.log('Usuario ya autenticado con token:', token);
                // Aquí podrías mostrar una UI diferente para usuarios autenticados
            }
        });
    </script>
</head>

<body class="min-h-screen antialiased">

    <!-- Encabezado (Modularidad Lógica) -->
    <header class="sticky top-0 z-40 bg-white border-b border-gray-200 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5 flex justify-between items-center">
            <!-- Logo/Marca -->
            <div class="flex items-center space-x-3 group cursor-pointer">
                <!-- Icono de la inmobiliaria -->
                <div
                    class="bg-gradient-to-br from-indigo-600 to-indigo-700 p-3 rounded-xl shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                    <img src="iconos/arcoIcono.png" alt="InMobirelia Logo" class="w-8 h-8 object-contain">
                </div>
                <div>
                    <span class="text-2xl font-black tracking-tight transition-colors duration-300">
                        <span class="text-gray-900 group-hover:text-indigo-600">In</span><span
                            class="text-indigo-600">Mo</span><span
                            class="text-gray-900 group-hover:text-indigo-600">bi</span><span
                            class="text-indigo-600">relia</span>
                    </span>
                    <p class="text-xs text-gray-500 font-medium">Tu hogar ideal</p>
                </div>
            </div>

            <!-- Botones de Autenticación (Modularidad Lógica) -->
            <div class="flex space-x-3 md:space-x-4">
                <!-- Botón Iniciar Sesión (Minimalista, Borde Azul) -->
                <button id="login-btn"
                    class="flex items-center px-6 py-3 text-base font-semibold text-indigo-600 border-2 border-indigo-600 rounded-xl hover:bg-indigo-50 hover:shadow-lg hover:scale-105 transition-all duration-300 active:scale-95"
                    aria-label="Iniciar Sesión">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                        class="mr-2">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                        <path d="M10 17l5-5-5-5" />
                        <path d="M15 12H3" />
                    </svg>
                    Iniciar Sesión
                </button>

                <!-- Botón Registrar (Resaltado, Fondo Azul) -->
                <button id="register-btn"
                    class="flex items-center px-6 py-3 text-base font-semibold text-white bg-gradient-to-r from-indigo-600 to-indigo-700 rounded-xl shadow-xl hover:shadow-2xl hover:from-indigo-700 hover:to-indigo-800 hover:scale-105 transition-all duration-300 active:scale-95"
                    aria-label="Registrar Nueva Cuenta">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                        class="mr-2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <line x1="19" y1="8" x2="19" y2="14" />
                        <line x1="22" y1="11" x2="16" y2="11" />
                    </svg>
                    Registrar
                </button>
            </div>
        </div>
    </header>

    <!-- Sección Principal (Hero Section) -->
    <main class="flex items-center justify-center min-h-[calc(100vh-80px)]">
        <div class="max-w-3xl mx-auto p-8 text-center">
            <!-- Título Principal (Responsivo) -->
            <h1
                class="text-5xl sm:text-6xl lg:text-7xl font-extrabold tracking-tighter text-gray-900 leading-tight mb-6">
                Busca una casa,
                <span class="block text-indigo-600 mt-2">Encuentra tu hogar</span>
            </h1>

            <!-- Subtítulo -->
            <p class="text-lg md:text-xl text-gray-600 mb-10 max-w-xl mx-auto">
                Explora nuestra selección curada de casas, apartamentos y terrenos. Tu búsqueda termina aquí.
            </p>

            <!-- Botón de Explorar (Acción Primaria) -->
            <button id="explore-btn"
                class="inline-flex items-center justify-center px-10 py-4 text-xl font-semibold text-white bg-indigo-600 rounded-xl shadow-xl hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-300">
                <!-- Icono de Búsqueda (SVG inline) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                    <circle cx="11" cy="11" r="8" />
                    <line x1="21" y1="21" x2="16.65" y2="16.65" />
                </svg>
                Explorar Propiedades
            </button>
        </div>
    </main>

    <!-- Modal de Login -->
    <div id="login-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative animate-fade-in">
            <!-- Botón Cerrar -->
            <button class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>

            <!-- Contenido del Modal -->
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Iniciar Sesión</h2>
                <p class="text-gray-600">Accede a tu cuenta de InMobirelia</p>
            </div>

            <!-- Formulario de Login -->
            <form id="login-form" class="space-y-6">
                <!-- Email -->
                <div>
                    <label for="login-email" class="block text-sm font-semibold text-gray-700 mb-2">
                        Email
                    </label>
                    <input type="email" id="login-email" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="tu@email.com">
                </div>

                <!-- Contraseña -->
                <div>
                    <label for="login-password" class="block text-sm font-semibold text-gray-700 mb-2">
                        Contraseña
                    </label>
                    <input type="password" id="login-password" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="••••••••">
                </div>

                <!-- Botón de Acceder -->
                <button type="submit"
                    class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-indigo-800 transition-all duration-300 shadow-lg hover:shadow-xl">
                    Acceder
                </button>

                <!-- Enlace a Registro -->
                <p class="text-center text-sm text-gray-600">
                    ¿No tienes cuenta?
                    <a href="#" id="go-to-register"
                        class="text-indigo-600 font-semibold hover:text-indigo-700 transition-colors">
                        Regístrate aquí
                    </a>
                </p>
            </form>
        </div>
    </div>

    <!-- Modal de Registro -->
    <div id="register-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative animate-fade-in">
            <!-- Botón Cerrar -->
            <button class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>

            <!-- Contenido del Modal -->
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Crear Cuenta</h2>
                <p class="text-gray-600">Únete a InMobirelia hoy mismo</p>
            </div>

            <!-- Formulario de Registro -->
            <form id="register-form" class="space-y-5">
                <!-- Email -->
                <div>
                    <label for="register-email" class="block text-sm font-semibold text-gray-700 mb-2">
                        Email
                    </label>
                    <input type="email" id="register-email" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="tu@email.com">
                </div>

                <!-- Nombres -->
                <div>
                    <label for="register-nombres" class="block text-sm font-semibold text-gray-700 mb-2">
                        Nombres
                    </label>
                    <input type="text" id="register-nombres" required maxlength="100"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="Tus nombres">
                </div>

                <!-- Apellidos -->
                <div>
                    <label for="register-apellidos" class="block text-sm font-semibold text-gray-700 mb-2">
                        Apellidos
                    </label>
                    <input type="text" id="register-apellidos" required maxlength="100"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="Tus apellidos">
                </div>

                <!-- Contraseña -->
                <div>
                    <label for="register-password" class="block text-sm font-semibold text-gray-700 mb-2">
                        Contraseña
                    </label>
                    <input type="password" id="register-password" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="••••••••">
                </div>

                <!-- Confirmar Contraseña -->
                <div>
                    <label for="register-confirm-password" class="block text-sm font-semibold text-gray-700 mb-2">
                        Confirmar Contraseña
                    </label>
                    <input type="password" id="register-confirm-password" required
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-600 focus:outline-none transition-colors"
                        placeholder="••••••••">
                </div>

                <!-- Botón de Crear Cuenta -->
                <button type="submit"
                    class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-indigo-800 transition-all duration-300 shadow-lg hover:shadow-xl">
                    Crear Cuenta
                </button>

                <!-- Enlace a Login -->
                <p class="text-center text-sm text-gray-600">
                    ¿Ya tienes cuenta?
                    <a href="#" id="go-to-login"
                        class="text-indigo-600 font-semibold hover:text-indigo-700 transition-colors">
                        Inicia sesión aquí
                    </a>
                </p>
            </form>
        </div>
    </div>

    <!-- Pie de página simple -->
    <footer class="w-full py-4 text-center text-gray-500 text-xs border-t border-gray-100 bg-white">
        &copy; 2024 InMobirelia. Propiedad y Diseño.
    </footer>
</body>

</html>